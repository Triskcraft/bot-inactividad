datasource db {
    provider = "postgresql"
}

generator client {
    provider               = "prisma-client"
    engineType             = "client"
    output                 = "./generated"
    runtime                = "nodejs"
    moduleFormat           = "esm"
    generatedFileExtension = "ts"
    importFileExtension    = "js"
    previewFeatures        = ["typedSql"]
}

model InactivityPeriod {
    user_id       String   @id
    guild_id      String
    role_snapshot String
    started_at    DateTime @default(now())
    ends_at       DateTime
    source        String
    notified      Boolean

    @@map("inactivity_periods")
}

model TrackedRole {
    guild_id   String
    role_id    String
    created_at DateTime @default(now())

    @@id([guild_id, role_id])
    @@map("tracked_roles")
}

model RoleStatistic {
    id             String   @id @default(dbgenerated("snowflake()"))
    guild_id       String
    role_id        String
    inactive_count Int
    active_count   Int
    captured_at    DateTime @default(now())

    @@map("role_statistics")
}

model Link {
    id         String @id @default(dbgenerated("snowflake()"))
    discord_id String @unique
    mc_id      String @unique

    discord_user DiscordUser?   @relation(fields: [id], references: [id])
    mc_user      MinecraftUser? @relation(fields: [mc_id], references: [id])

    @@map("links")
}

model LinkCode {
    id               String @id @default(dbgenerated("snowflake()"))
    discord_id       String @unique
    discord_nickname String
    code             String @unique

    @@map("link_codes")
}

model Role {
    id   String @id @default(dbgenerated("snowflake()"))
    name String

    linked_roles LinkedRole[]

    @@map("roles")
}

model LinkedRole {
    mc_user_id String
    role_id    String

    role           Role          @relation(fields: [role_id], references: [id])
    minecraft_user MinecraftUser @relation(fields: [mc_user_id], references: [id])

    @@id([mc_user_id, role_id])
    @@map("linked_roles")
}

model Medias {
    id         String @id @default(dbgenerated("snowflake()"))
    mc_user_id String
    media_type String
    media_url  String

    minecraft_user MinecraftUser @relation(fields: [mc_user_id], references: [id])

    @@map("medias")
}

model MinecraftUser {
    id          String @id
    nickname    String
    digs        Int    @default(0)
    role        String
    description String

    linked_roles LinkedRole[]
    link         Link?
    medias       Medias[]

    @@map("minecraft_users")
}

model DiscordUser {
    id   String @id
    rank String

    link Link?

    @@map("discord_users")
}
